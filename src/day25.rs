//! <https://adventofcode.com/2021/day/25>

use simple_grid::{Grid, GridIndex};

const INPUT: [&str; 137] = [
    ".>.vv>..v..>..>.>>v>vv.v...v>v.......v..v.>...>v...v>>v.>.v...v.v.v...>v.vvv>.v.v...>....vv..v>v>.v..>>..v.v.v.v.v.v>v.>>vv.v..vv.v...v.v..",
    ".>...v.vv..v>v>.>....v.v.....v>..v>.v....v..vvv>....vv...vv.>>..vv>v..>.>>.>>v..>>..v>...v.v.v>v.v.v>v.v>vv...>.........>>vv....>v..>v.vv>.",
    "v...>v>v>..>>vv....>>>.vv>>.v..vv>.v....v.v>v>..>...>v>vv>.>>.>.v..v>....>v.....>>..v.....>.>v..v.v>.>vv..v>v..>v.>vvv>...v.>.......v>>>...",
    "vvv>..>...v.>.>.>>>>>.>v>>v..>.v>.vv..v>v>>.....v.v>.v.v..v>>>>.v..v>.v.v.v>.....v..>...>>v>.>>>>v...>..vv>.v...........vvv.>>.>.v.>>>.>.v>",
    "v>......>>vv>.>..>>.>>>.>v..v>....v..v.>>.v.v>>v>.>.v.v..>..>....v>>...v.v..v.v..v..>.>>>.>..>..vvvv>>.>v>>v..vv..v>.....v>>..>......>..>>v",
    "...v....v.v..v.......v..>v>...>>..>....v..v>.v..v>....v>>..v>v.>....>v...>>.vv>>vvv....>.v.....v....vv.vvvv>...>..v>v>...v.>v>.v.>>..v...>.",
    ".v..>...v>v........v..v....>.>v.>>....vv..>..>...>.>v..v>...v>.v..v..v.v>vvvv..>>>>.v.>..v..>>>.v>...v.v>.vv...v.v>..vv.v.>..v...>.>v.v>.>.",
    "...>.>.>>.v..>v>.v..>v......>...v.>>....>.>v>>>...v.v....>v...vvv..v.v>v>vv....>vvv>...>........>>>v...>>.........>v>.vv..>.>...vv..v...>..",
    ">..>>...vv>..v.>..>.v.>....>>>..vv>>..v..v..v>v.......>...v.>.vv>v.>vvv>>.v..v.v.>...v..v..v.v.vvv>.>.>>.>....vv.vv.....vvv...>.>.vv.>..>..",
    ">.v>..v.>.>>>>.vv>.>v.>v>vv...>.......>vv.vv.>>>.>..vv..v..v.>..>vv>v>...v.>v...v....>>.>v....v>...>.v.vv>....>..>....>.vv.v.vv....>>.v>.>v",
    "...>>.v>>..vv..v...v>..v>.>.>.>vv....>>>...v..>>.>.>vv.>...>vv..v.v>v>>>.>..vvv>....>.v>>..>vvv.>.vv...>..v.>>>>vv....>..v>vv.>>.v.vvvv>vv.",
    "v>.....>>.>....v....>>.vvv>.>>>vv........>v...v>vv.v>......>..>..vvvv>>>.>.>>v.v.v..v.>>vv.vv..>.vv>>..>.v>vvv..v.>.>.vv>v>>..>.v..>>.>vvv>",
    "v>v>...>.v>.>....>..>.v.v..v.>...>>..>v.>vv.>v>.>.v>>>v.>v>..>..v.>>>v.v..>...vvv....>>v>......v..>v.v..v>..vv...>.....>......v.v.>>v......",
    "v>>.vv>.>.v.>....vvvvvv.vv.v.....v.....v>>v.>.v..v..>>>>v>>..>....v.v..>>...v>>>>...vv..>.....>.v>>v..>v>>..v>>.v..>.....>..v...v.vv.>.v.v>",
    ">...v>..>>>..>vv..>.>>vvv.>>>v.>.>v.>...>.vv>v.>...v>.v.v..>v>.......v>>v..vv.vvvv.vv..v..>>vv.v.>>>..v>v.vvv>>...>..>.v..>vv..v>v...>v>.v>",
    "v..>>v.v>..v...vv>..>v.v>>...>>.>..>>..v>..>.v>v..v..v>vv.v>.>v...>vv>....v..vv...vv>vv.>>.>v....v>.>v>.>.>v.....vv..v.v>.v......>....vv...",
    "v..>..v>>...>>>.v..>.vvv>......>>>.>v...v..vvvv..>>v......vv>.v>...>>.>v...>>.....>>v.>>>...v..v>....>v.>>>v>v.v.v>>.v>....v.vv...>.>>....v",
    ".>>.>.>v.>..>v>..>>..>.>>....>>v>.>....v.>..>...>..v.>v.v.vv>.>..vv.>.v>.>..........>.>.>.>v>v...>>..>..........v..>>...>....>..>>>>>v.>.v.",
    ">.v.....>.......>v>v..v....vv>....vv>v>vv>.v.v>.vvv.v...>>..v...v.>.....v.>.>>...vv>vv..>vv..>v...v>v.v...>.v>vvvv>>>>.>v.>.vv>>.>..v.>..>>",
    ".v>.>.v.vv>>v>.....v.v..v.>.vvv>>>>.>..v...>v...>v>vvv..v>v....v...v>.v>>.vv.v.v.>......v>.>vv.vvv.v.v....v.>v>..>v...v>.>.>...>vv>.>.>.v>>",
    "....v...vv.>.v..>..>.v>.>v.v>vv...>.>>v......vv>..>>..>..>.v...v..>vv....>.>..>v>>....v>>v>.>.>.>>v....v..v>..>.....>>>>>..v..v...vv..v.>.v",
    ".....v.v.v..>vv>........>>>vv...>v..v..v.v>.>v.>...>>>.v...>vvv......>..>..>>.v...v>v.vvv>.vv>...v>.....v.....>vv.>v>>.>..v.vv.>vv>v.......",
    "..>>.vvv...>>>.v.v.....v>...v>>v.>..>..v>v.v..>.>.vv...v>v>v....>>.vv..>..>..v.>>..>.vv.>v.v..vv..>.>..>>v...>>...v.v>v.>.>>>.>>.v...>>..vv",
    ">.......>.>.>..v...v>v>>....vv.>.v...>.v>.v>.>.....>v.>>.v.vv.>..v..v>v.>..v..v.v.vv.>vv>..v>...vv.vv>.>..>...>v.>..>.v.....v.v>....>....>.",
    ".vv.>.v......v...v......v.vv>v>....v.v.>>...>>.v>>>..>.>v>>>>v.v>v>v..>..v.>.v.>....v>vv>...>..>>.v>vvv....v......>.>.>.v>v.>v..>>.>vv....>",
    ">..>..>v>..v.>.v>>.vv>..>...v.v>..>v..vv.v>.>.....v>.>>.>>>.>>..>...v.v..v..>.v.v.v..>v..>v.>.>.>>..vv.>>v.>v..>v.>.>.v......>.v>.>.>v..v>>",
    ".>..>..>>..vv.v..>v>....>.>v....v.vv.vv.>v.v>>.vv.>>>...>...>v.>v>.>v>>>>...>>....v>.v.v>>>>v>.>v.v..>...>v..>vv.v>v>v.>v.>>..v>.>>.>..v..>",
    ".vvv...v...>>...v.>.....v.vv...vv...>.v.>>..v.>...>.>>v.vvv.>...>vvv..........vv....v..v..v>vvv>vvv.v.v..>>...v>>v...>vv.>.v.v..v>.vv....>>",
    "..v>.>......v.vvv...v>>.>vv...v..v.v...>.v..vv..v>....v>>>.>v.vv.v.v..>.>>..vv.v.>v.>...v.vvv..v...>..>......v>.vv>vv.v..vv>>>>...v.v>v.>.>",
    "v>>>>..>v.>.>.>..>.>.vv.vv.vv..v........>vv>>...v>>.>..>.v.>>>>..>v....v..vv>.....>.>.vv...v..v>.>.v.vvvv>..>v...v.>.vvv>vv..vv.v.v.>vv.>..",
    ">.vvv..>>..>v>..>..v....>>>v>>..>....v.v.>>.....>>vv>vvv.>>.v...>.v..vvv..>.>vv.>v.v>...>..v......vv>>...vv.>.>.v>v.>...v.>.v.v..v..v..v>..",
    ">v>>v..>..vv.v.vv..v.v.v>...v>v.>.>>..>>v..>v.v.>>vv....v.>v>.v...v>.v.>....v...v.>>.>v>vv...v..>.v..vv>v>...>>>.v.>..v..>..vv.v>.v.vv.>.v>",
    "v..v..>v....v..>>.>>v...v.>v>v>>.v...>>>..v.>.vv..>.....vv>..v.>.vv...>>vvvv.vv>v>vv..>..>v.>>vv>.>v.......v.>.....>v>.v>v.>....>......>v>.",
    "..>.>..>v>..v...v.>v>v>..>>.>.>........>..v.v..v>>..v...>>>...v>.v>v.>>...>>v..v..>.v.>..>v>vv>>>.......v...>.>...>.>>>...>..>.>>...>....v.",
    ">>.>..v.v...>...>v..v.>.v.>...vv>..>>v>..>v>vv.v>...v.v..>>.>v.>..v...vv.v..>..>>.v...vv..>...v..>....vv.>...v>.vv>....v>>>>v>>>.v..v>v.v..",
    ">....>vv..v>>>....vv>>vv.v>.v>>..v.......>.v...v>v.vv.v..v...v>>>.>v.vv..vvv>..v>.>...>...v>.>..v.>>.>>>.>.v>>v>.v.v..v>>.>>....>..v>...v.>",
    ".vvv...>>.>>.>>...v...v.>.>v.>>.v>.>>.>.v>..>..v>>.>v>v.>>v>>...>.v..>>..>>v.v.v>.vv.>..v>>>.>>v.>.>..>v..>vv>..v>...v.>vv..v>v>..v.>.>.>..",
    "v.v.>.v.>>.>>.>>>v>..>.>.v..>..>..v...>>.>.vv.v>v.v.....vv...vvv.vv.>..v.v>.>>.vv.v>...>.vv...>..>..>v>>vv..>..>........vv.v.v....v...>vv>.",
    ">>>..>..>v>.>.>v.>...>.v..>v......>vv.vv.v.>.....vv..vv.v.....vv..>>...v...>.v.vvvv.....>vv...>v.>....>..>>.vvv>v>..>v>.>.>.v.>>>.vv.......",
    ">>v>v>.>>>.>v....v...>..v.>.v>..v.>vv>..v.>...>vvv......v..>>>v>>.v>...v..>>....>.v...>>vvv>...vv.v>..v>vv>vv..>....>vv>..>.....>v>>v>>.v..",
    ".v>....>.v...>>....v>>>v.......v.v.>v>>...v.vv.>vvv>vvv.>>..>.>.v>vv.v>.....>..>...>v..>....v>v.>v>.>>vvv.>.>vv.v...>v.>.v>v.v>..>...>v.>..",
    ".>v>>v.v.>vvv.>......>..v>v..v..v>...>.v>v>v.v>...>..vv....vv.v>.v.vv>..vv>...>.vv.>>v.>>.vv...>...v...>..>v>vv>...>v.....v...v..v>vvv..>.v",
    ">...>..v>...v..>>>>>.v...vv.....>>..>....>v.....v..>>....v.>.>..>v>..>v.>.>>v>v.>....>..v..>..>>vv...v>>.v....v......>vv..v.v..vvv.v>>v..>>",
    "v.>.v>.v>.......>....v.>>v..v>>>v.>.v.vv.....v>..>v.>>vv...>>.>v>.>vvv..vvv>v>...v..>v.>.v.>.>.v.>.v.v.>...v>v.>.vv.>..v..>>>>...v..>v>v>..",
    "v>>vv>..v.v.vvv..v>.>.>v..>v.v..v.>v.v>>v..>>>..v..v.>.>>.vv>.>>>v.>..>.v>vvv.>>.....v>>.>vvv.vv.v>.v>>..vv>>>.>>>vv..v...v...v.vv.v.vv>..v",
    ".>v>.>v>>.v.>...vv...v..v.v.v>v...>>.>>..v.v..vvv>>vv.>vvv>>.>v.v..>...>v>>..vv.v.v....v.>v>.>.v.>>>v.>...vv...v....v>v>.v.>v>>..v..v>..v..",
    ".>...>vv....v>.v.>>..>.v.....v.>>.>......vv....>.v..vv...v..>>..>>>.>v>..>..vv>.>vv>.........>....>v>...>vvv.v.v>vv.>vvv>>v....v..>..vv..vv",
    ">.>v>v>>v>>..v...>..>.v>.v.v.v..>>.>.>>vv>vv>.vv.>.vv....>v.....>v..>>v.>>....>..>..v.v>v.vv...vv>.>...>v>.v.>.>v....>......>>>>>v.>.v.>...",
    ">v>v.>...v..v..>..vv......>v...>v>v..>vvvvv>v.>>..>v.vvv.>..>>>>>.>...v.......>.>..>.>>.....v.v..>>.>v>v>..v....>v..v..vv.>>.>..v>>.>v..>.v",
    ".vv>>.>v.>v.>.v...>..>v.>..vv...v>>..v..v>>..>>..vv.>v....>vv.>>..>>>vvv.v.>.>.vv..v..v>..>.v>.>..>.>..v>v.v.v>..>...vv.>.>>...>>.......v>.",
    ">..>.v...>>...>......v>vv>>>v.v.>>.>.v.>..v.>.>.vvv>..>>v...>>>vv>.>vv>>..>.v....v>..>vv>.>.....vv...>....>>..>>.>.>v>......>>.....>.>v>>>>",
    ".>v>....v....vv..>..v.v.vv...v.vvvv>v..v..>>..v.>>>.>v>>.......v.>.>>..>v>v..v..v>.>>vv...>..v.>...>..v>..v>v.v..v.>.v.>v.v.vv..vv.vv.v....",
    ">.v>vv.>.v>.>.>.........v......v..>.vv>.....>...>.>>.>>vv>>.v.v..v..v..vvv.>>>>..>vv>.>..vvv>v>>vvv>v...>..v>.....>.v.>vv....v>v>....v....>",
    ".>.v>>.vvv.>v.>>..>....>...v.>.>vv.>...>vv..>vv>.v.v.>...v>>..v....v>.v>v.>.>.vvv.>vv...v...vv.>..v>...>..v......>v..v>>.>>..v.>..>>..>>vvv",
    ".>>v>>.>v.>>vvvv.vv>>>v..v>>..>..>.>.>..v.>...v>vv.>>>>>v>.v.>v>v.v..>.v.......>.v>.v>.......>..>.v..>....v>.>v.....>..>.>.vv....>>>v..>>>v",
    "....>.>>>.>.v.v.v.....vv.>.>vv....>....>v..v>.>..>.>.....>>v>.>.v>...v.....vv..>..>.....>.>...v>.v..vv....v.vvv>.v...v>v.vv>v>v.>vv>>vvv.>>",
    ">>>...>>..vv.......>vv>>v.>..vv.>>>v..v>v..>>v.>..>>.vv.v>>......>.>..v.>..>v>>>...>v...vv>.>...v....v.v...>v.v......>.vvvvv.v....vv.v>...>",
    ">>..v...>>.v>v..v>.>>.v>....v.vvv....>.>..>>>v>..>>v........v.vv.v..>>..>.>.v....v.>.v..vv>.>v..>.v>>>.....>..v...v..>.v>.v>.>.v..vv.>>>..v",
    ">..>.>>.>..>>..>>..>.v>v>.v.>>.>>..vv.vv....v.....v.vv>v>.....v>.v..>>>.v...>v>.>v......>..>>...>v....v...v.v..vv>..v>>>...vv.v>.>.....>v>.",
    ">>.v>v...vv...v>..v>.>v.v..v.>..>..v.>>.....>.v>.>.v>.v>>..>.>v.vv...v.vv.>vv.v.v.vvv>>..v.v....v..>...v.>v....v>.v.vv.v>.....>>..vv>.>.v..",
    ">.v...v>.....vv>>vv.vv..>..vv>v.v..vvv.>vv.v.v>v>v.>>.v.vvv>.v.v.vv>v....v>>.v.>v.>.>..>.v.v.>>.v>v.>>>.>....vv..v>>v.v.>v.v..>>>.v>>.v>.>v",
    "..v.>..>.v.vv...>.>>v...v>...v...v>.....vvvvv.v.v..>>>..>>.>..>....>..v.v>>...v>>..v.....v.>..v.v.>...v....>......v.>>.vv.....vv>>....>>.v.",
    ">..v..v.v.>...vvv>v.v.v.>...>vvvv.v..v>v>v...vv>..v.>>>>..v.>v>..>.v.>..v>.v>.>.>..>>vv..>.vv.v>.vv......vv.>v..v.>.>>...v....v>vv..>.v..>.",
    "v.>>.>...>.....v.>>.>>v.v>.>.>.v>..>vvvv>....vv.>.v>vv>vvv>.>vvv.v.v..>..vv.>.v.v..>..vv.....>.>..v..vv.vv>.>v..>..v.v..>vvv..>>.>.>..>...>",
    ">.........>v...>.>>>.>.v....>..vv..v.v.v>..>v.v.vv>...v.v>>...>v..v>vv>>>...>.....>v.>v>v>vv.>...v>>.>.v>v....v...>v>.>.v...>vv.v...>vvv>.>",
    "..>..v.>v......>.>.v.v.....v..>....>..>.>.vv>>..v>v...>v.>v>v..vv>...>..>..v.>.>..vv>v>>>>....v..v....v>..>..>v...vv...>>.>...v....>...vv>>",
    ">v....>>.>vvv.vvv>>>v..vvvv>.v...>>.v.>>v...>>>.v>>..vv.....v>.vv>>...>..>v>>v..vvv..>v>v....>..>>..vv.>..v>>vv>..>...>.v>>....vv.>vv>vvvv.",
    ".v...v.>>.>..>..>v..>>...>v...>v.v>>v>>v..vv.>>.vv>.>.>>v.>v>v>.v..>....>.>v..v>v>v..vv..v.v>.vv>.>.v>>vv>v>v.>>..v.>.v..v..>.v...>.v>....>",
    ".v..>.....v.vv>>...>>>.v.v.>.>v.>v>vvv>>.>.vv.v>...v....>.>v.vvvv.v...>.>>v.vv...>>.>.>>.v.vv>.>.>.......v>..v.....v.vv...v.....v.v>.>v....",
    ">v.v.vv.>>.v..>...>....>>>>.vvv.v.v..vv>>>>..>...>v.v.........>>.v..>vv.v>>.v>>..vv.vvv..>...>v.....>.>...>>.vv>.v>..>.vvv..>.vv.>>.vv.v>vv",
    "..v....vv.v.>vvv>...v>>..........vvv>>..v>>>..vv..>.vv..>>.v>vv...vvv>vvv..v>.>vv...v....>>>.vv..>.>.>.>vv.>..vv>v.>vv.>v>.v.v>vvv.>v..>..v",
    "v.v...>>.>.>.v>>>......vv.>..v.>..v.v..v.>.v..>>...v.......v..>v.vv>....vv>..v.v....v..v.....>>..>....>.v.......v....v>>......v...>.v.v....",
    ">..>>v...>>>..>vv.v...v>.v.v.v....>v....v.>..>.>..>.>>.v.v>>....>>v...>v.......>v..v...>vv...>v..v..v..vv>..v>.....v>.vv.v.....v.v..vvv>>.>",
    "....>....>....vv.>.>....v>v>>.v>.v.>v>.vv.v>>>>.>.>....>>>>>vv>>..>.>.vv..>vvvv..>.v>vv.>.v...>>...>v>vv>v......>..v..>.>>.v.>>.>>...>.>>vv",
    ">.v.>v.v>.v>vv>>.>.vv.>.>>..>>v.v.>>......v>.v.vv....v.>vv...>..v.v.>v.>..v>...>v....>>>v>>.....>vv.>..vv.v...>>v...vv.v.v.v>vv..v.>v.>vvv>",
    "..>...>>v.>>.>.vv>.vv>..>>.>v...>>>.v>v...v>v...v..>>v.....>v...>vv.>...v.>v>.>.>>..>.>.v>..v.>..>...v.>...>..v..v.>>>..vv..>>..v..>..>.>.v",
    ".v>>...>>..>..v>vv...v..v.v.v..>.>>...>...>.v..>v>..>>.v>.v.>v>......>........v..v......v>v>>.v...>>..v.>v.>>...>>>.>..v..>...>>v..>>...vv.",
    "..>.v.>v.>>.v..v.v.>v....v>vv......>.v..v.v..v.v.v...>.....v.v>>v......v>.>.....v..>v.v>.>.>...v.vvv...>.>>.v..v..>....>.>vv>...v>v>v>.....",
    "vvv.v.....>>>.v.>v.vvv.>.v.>....>...v.>.>.>.vv.>.>v>..>...>.v..>..vv>.v...>...>..v.......>>>...>..>..>.v.....v>.v..v..>>..v.>>.vv.vv>.>.>.v",
    "vv..>.v.v.>.>.>.....vv..v>.v>..v>v>vvv.>>..>....v..v......>.vv>>...>.vvv>vvv.>>v..v..>>>vv.vv.v.>.>.>..>>....>.>>.>vv..>>>v>v.>v...v..vv..>",
    "v.>v....>>.>vv..v>>..>.v..>vv.>vv..>>v>v>vvv>v>vvv>..>>....>>.v...>v.v.v.v....>.....>>>...>.>>v..vvv.>v..v.>>......>vvv.>v...>>...>>v.vv..>",
    "v..>.vv.....>v..>v.v>.v..>.v.....>..v......v..v...v>>.>.v...v>.v>..v....>....>v.>>..vvv..>..>vv>..vv>>vv....v>.v.>..v>>v>>>..vvv>....v...>>",
    "v..>>>..v.>>>.v...vv..>>v...>.....>>v....v..v>>>...>..>.v....v.>v.....v.vv>..>..>.>..>.>....>v......v.v.>......>.>>.....v..v>.>v.>..v.v>v.>",
    ">>.>..>>>.>.v>vvv>>>...v.v.vvv>v>>...v>..>>...vvv.>v>>vvv.>>.v.vv..v..>v>v>.v>v>...v.>....>.>v.vv..>v.>.>..v...vvv>v>.v>>.>vv.v.v..>...>>>.",
    "vv..>...v.vv.>.vv>.>>...>..v>>.>...>>>>.v>vv..v.>>>>......>v>>..v>v.....>>.v....>>>.>..>.>vvvv>.v.vv.vvv..>>>v...>v...vv>>>>v..vvv......v..",
    "...v..v.v>>.>v.v..v.>>>..>.>vv.>>...v.v.>...>..v>.v>...>..vv..vv>v>.v>.v.v>v>.>.>..v..v>.vv.......>>v>v>vv...>>v>>>.>>v.v...>>..v>...vvvv..",
    ">vv.v.>.>>.v....>>>vvvv.>>vv.v.>...>v.v>>..v..>...v..>..>>>...v....vv...>..v.v..>v>>.>.v....>v..v.v.>.vvvvv..vvv>...>..v.v>vvv>v>>vv>>>vvv.",
    "v..>>v.vv....>.>>>v...>>v.v.v>.....v..>>vvvv.>.v.>.v.>v.......v>.>...v..>>...vv>vvv>....>>>>v>.>..vvv>v.>...>>>>>>>.vv>..>..v..v..v.vv>...>",
    ".v...>.vvv.vv>.>...>...v..v>v.vv.>v>.>>.vv>..>>..v.v..v..v>.v.>v......vv......>...v>v>v.>>.v..>>.>>.>v..v>.v>.v....>.>.....vvv.v...v>v.>.>v",
    "....>>.v....v>.v>.>....>.>.>v..v>>vv...vv>.>>>.vvv...>vvvv..v>.>..v..>..>...>.v.>>>.v>...v.v>..vv.v.>...v..v>>.v>>>>vvvvvv..>.>vv.v.>v....v",
    ".....v.>.>>.>>.v.v.>.v.vvv>.>v.v.>.v.>>v>..v.>.>.........>>..>>>...vv>>.v..vv.>v>.vvv>..>v.v>....>>v>vv.>vvvv>.v.v.>.v>>v...>.vv..v.>v>.v.>",
    "v.>.vvvvv>v..>v>....vv.>vvv>.v.v..>..v.>.....v...v...>vv.v.vv.>>>>...>>...>>.v>>.v..>>v>..vv>.v.v>>.>.>...v..>v.>>...>....>.v>.>.v>.>>.vvv.",
    "v>v.....v...v...v.vv..v>..v.>vv>.....v>>v.>>..>.>.v.v..v>..vv.vv...v>v.....>..>....vv.v..>v.>..>>..>>>>>>.>.>...v.v..v...vv>vv>...>.>v...>.",
    ">..v.>vv.v..vv.....>>...>vvv>v.........v>..>>..v>v....>>v.>v>v>....v>v.>>..>.....v..v.vv.>.>.>...vvv.v...v>>.v>v.....>.v.>..v>v..>v....v...",
    "...v>.vv..v>>>vv...v.>>....vv.>.>.>>>>.....>..vvv..>v.>>v.>..>v...v>>..>>.>v.v.>.v.vv..>.vv.>>>....>v>....>..>..>....v..>....v>v>vvv.v.v...",
    ".v..vv>.>..>.>>.>v.v>>>v..vv>...v.>v>.v..v>v>>v>v....vv>>v.....>v..v.>....vvv..v>..vv..>.v>vv...v...vv>.v..>.vv>>.v.v..>....v.>.vv>>..vvv..",
    "..>vv...v.>v>v.>..v..>.>.v..v>..>..v.>vv.>v.>v.vvvv.>>vv>v..v...vvvv.>v>.v.vv>>>.v.......>>>.>>>.vv>>>..>..vv..>v.v>...>>.>>.v.vv>.v>>v.vv.",
    "v.vv.v.>>.....vv>.>v.>.>....>..>v.v.>.>v>>...v.vv.>>v.....v...v.v>>..v......v>>>>vv.v>.v>v>>.>.>>>>..v....v>v.>v....v..vv>vvv..v.v..v>.....",
    "...>v.vv.>.v>>v>.v...v>v...>.v.>v.>>..v.vv.v.>..v.>v>..>..>>>v...v.v.....>.v..>.vv.v..v.....>v>...v..>.>v..>.v.vv.....>...>.vvv>.v...v.....",
    "...v.....v..>.>>..v.v>>.vvv..>>...>.v.v....v.>.vv..>>v..v>.>vv>..v.vvv..v.>vv.>....v>.vv..v...>v..v>>...>.v>.v..>>.vv.v.v.>>>....>>>.>>.v>>",
    "v..>>.v.>>>v.vv....v>.........v>.vv>>>.>v.>vv.v>....vv>vv.>...v.>.v.v....v...v...>......vv>.v..>vv.>v>..vv>>.>>v....>.>v>..v>>.>>>.......>>",
    ">....v...v.>v>..v>....>vvv..>.v>.....v.>.>>v..v>...>..>.>v..>...>>.v.>...>v...>.vv.v..v....v.v.>>.v..v.v.vv...vv.>.v..v..>>v....>>v>>......",
    ".vv..>>>....>v.....vvv>>..v>..v..>...v....>...>...v.>..>>.v.vv.vv.>.v.>.>>v>.v.>>v..>.v>v.>v>..v>....>>>..>.>>.>v....v>..v...>.>.vvvvv>>>..",
    ".v.>.vv.>..>....>v..>..>.>.>.>.v>vv>vvv..vv>.>v.....v.>>>.v>.>>.>.>>>>.v.>v..v.vv...v...vv.>........v....>..>>.v>.vvv>..v.>>vv.>.v.>>.vv>.>",
    ".v...>>...v.v.v.>..v>..v..vv.vv>>.>...>...vvv.vv..vvv.v.v.>>...>>>...vv>.>>>.>>>>>v.vv..v.>....v.v....>>....v>..>.v>v>v...v.>....>..>..v>v.",
    "v>..>>.>....>vv...>v.v..>...vvv..>.v>v..v>....>>v>.v..v.>..>>>>..>.v...>>..v.....>...v>.>..v...>v.>...vv>>.>>v>v..v>>.>v.v.vv.>v...>>>>>.vv",
    "v.>>.>.>..vvv.v.>...>>.>v..>.v>>..v>.v>.>.>..v.>.vv>v.v...v..>>>v......v........v.v.>>......v....>.v....vv>>.v......>.....>.v>........v>...",
    ">v>.vv>>v.v>vv>..>.vv.vvv.v.>.>..vv..v>v.vv.>v.vv....>.v.>>..v..v.>>>....v>>...>..v>v>>...>.>.v>vv>>.v..>v.>...v..v...v>..>...v..vv.v>v...v",
    "...>v.>v.>.....v..vvv....>.>v>..v..>vv...v.>...>...vvv..v.v....v>..>.......v>>.vvv..v...v>>vv.>vv>vv>v.v....>.v...v.>v..>>v>>.......v..>.>.",
    ".>v.......vv>vv..>.>..v>.vv>..v.>>.v..v>v.>....>>>vv>...>>..vv...vv....v...v.>.vv.vv.>v.v..>>..>.>...v..v..v>...>>>.>.v.>>v>..v...vv....>.>",
    ".......>.>..v>....v..>>>v..>...vv>.>.vv.....v>>v.v....vv..>v>vv..>v.>v.v.v.v>.>>>vv..>..>v.>>>>>>>>.v.v.>....>>v>>.v.v..>..>>...>...>.v.v>v",
    "..v.....v.v.vv>v>...>..vv.>>>.v.v..>.v..>vvv.>..>>.>.>.>.>>......>>..>>..>>vv..>v.v......v>>v...>vv...>.>v.v>..vv....v.v..>.>.>v>v.>.vv>..>",
    "v...>>.>.v>...>>..vv..v....>.>>v.>.>.>...>>v.>vvv...v.v.>.....v..>vv...v>v>>.>....v>..>.vv.>vvv.>v..vv>v>..>>..v..vv>v..vvv.>.vv....>v.>.v.",
    ">.v...>>...v>>..>.v>v>>.>.>.>vvv>>>....>>v....>>.>>v.>.v.>.v.>>v..v>..>.>v>>.v.>v>.vv>>..>.v.vv.v>v>v>.>.>v..>...>.v>vv.>v.v..>v>..>>..vv>v",
    "...>..v.>>.>.v>>v.v....v>...>.>>.v>>...>....vvvv..>.>..vv.>>vvvv...v.v>v>>v.v.v..v>.>.v>..>>..>.vv...v..v.....>>...vvv.>.v>....v....>..>v>.",
    "v>>..>...>v.v.v...>.>v..v..>.>.>>v>.v..>>.>.vvv..>>v.vv....>.>>>.v>...v.v...>>>>.v..v.>..vv...>...>v..>vv>.v>....v.>>..vv.>v>..>..v....>..>",
    ">..vv....vv>..v.v..v.>>>.>.>.v..>.vvvv...v>.>..vv.>vv.>...>>>...>.vv.v>>>>.v.....>v.>.>v.>v>>>....>>>..>>v>.>v..vv......>.>.v.v.>v.>...>.>v",
    ".>>vvv>>vv..vvv....vv.>.v>.v.>..v...vv..v.v..>>>..v.v>>.v.>.v.v...>>v..v.vv...vv.>v.vv...vv..v.v..v>......v.>.v.>>>.>..v..v.>..v.v......>..",
    ">........vvv>>...........>.>.>..>..v.v>v>.......v>..>.....>..>...v...v.vv.>..v..vvv>..vv.v>v.>.>>.....v.vvv...v.>..v>.>v.v>v>....v.v..v.v..",
    ".v>>.v..v.v>.v>...>.>.v.v..v.v.v.>......v....v>..v....>>vv.vv.>.v>.v.>>>...vv.v..v>>>.>vv>..v>>...v>.>..v..>..vv.>.>...>.v....vv...v.>.....",
    ">v..>v>.>..v.v.v...>....vv>v...vv.v.>>.v..>..>>.>v.>>>.v>..>.>>vv.v>v...>v..>.v..>.>.>>v>vv...v.>>v..>..v.vv>...v>.v.....v..>v>>v>.>>>....>",
    ".v>v.v....v>>...vv.v.>vv.>.>...>>v.v....>v.v.>..>>v.v>v.>..>>v.>....vv.v>v.vv...>.v>v.v.v.>.....>>v..vv...>.>v.vv.>v..v.v.v>vvvvv>>..>>.>v.",
    "...v.>vv>...>.v>v..>>...>.>..v>v..v>.v>v..v>...>>.v..v.vv>>>..v.v>vv>vv>....vv>.......v..vv...>.>v..v>>..vv..>>vv.>v...>.v>..v..>>..>.v....",
    "v>>>v.v.>..vvv..>.v.>....>.>v.vv>..>>>.v>.v>...>.v......>>....vv.v..>.>.vv...>.....v.v.vv>>.v.v>.>v...>.>.>v>.v.vvv.>.....>v..v.v>>v>..v.v.",
    "vv.>.>v.......v..>v.v.vv.>>...v>..>>.v..v...v>...>vv.>>.>>v..>>.....>.>vvvvv..v..>..v.....vv.>vv>>v>>vv.>>>>...vv>..>.>..vv.>v.>>v>..>vvv..",
    "....>vvv>.>v>>>...v.>v..>.v>..>..vv....v.>v.v..>>v.....>....>...>..>v..v...v.>..v>v.v.vv.>v....>>>..>v.v>...>..>...v>.>.v>vv.vv..>.>v.v..>v",
    "...vv>.>v..>.>.>.v>>.v.v..v>.vv.>..v..v>v.v>..>>.>.>vv>.>v..>>>>>vvv>>.v..>v.v>..>>>.vvv>v>v..>>v.vv>..v>.v..v..v...v>.......vv.>v..>.>>..v",
    ">....>....>>..v.v>v>v....v>>>.>..vv.....v.>>.v..>.>....>v.>v.>.>>..vv>....>.v..v...>v>>>>.>>.>...>>....>..vvvv..v.vv..v.v>>....vv>.v...v.v.",
    ".....v......>>v.v>.v.>v>.>>v>..>.>..v..>..v.v.v.>v..v..>vv>v.>v..vvv.v..vv....>..>.>v..v.>.........v..>v..v>>>.>v.v..v..v>v>..v>.>>v..>...v",
    ">>v>.>.......v>.>.v>v..>..>>....vv>..v>..v.>>>..>..>v.>...>v>vv>.v.v>vvv>.vv..>>.>.v.....>>.v......v..>..vvv..v>>...vvv...>vvv.>.>.>>>vv.>v",
    ".v>.v.v....v...>.v>.>vv..>>.v>>..v..v.>v>.>..v.v>..>vvv>>v.>>vvv...v>v>.v.v>v.vvv.v>..>>.>.v>.vv.v..v.v..vv..vvv.>v>....>v.v>v.>..v>.>vv>.>",
    ".>...>.>v.>.>>v.>>.>.>vvv.....v.....v>.v.>>>..v>....>v...v.vv.>v.>v>.>.>>.>>.>>...>..>.>.>..v..>v.....>v.>>vv>>.>>vv.vvv.>v.....>v>..>>>.vv",
    "v.vv...>v..v.>>>..>v>v...>.>..>>v..>.>>vv...>>>v..v.v>...v.v.v.>.v>.v.>v.v.v.>..v.v.v.>.vvv.>>...>....>......v..>..>>....>vvvv>>.v..>v.....",
    ".>>v>vv>.vv>...>..v>>..v.>..v.vv>vv....v>.>vv>>>v..>>.>.vv..v...v..v>..>>.>>v..>..>..v..v.>.vvvvvvv>>>.v>....v>.v>.v>>.v.>v.vv>>.vv.>v....>",
    ".v...v..v.>>.v.>vv.>.>v.>.vvv.vv..v>...v.v.v..>.v>..vv..v>vv>>vvvvv.v.>>>>...>.>v>.>v>>v..>>v.v.>>v>>...>...v.>v..>...>v...v>v.>v.>...v>>>.",
    ">v.....>>v..v>>...v....>...>>.v.>>....v......>v.>v...>.vv>..v>v.>>...>vvv.>v>..>v..>>.v........v>.v...>.v.v..vvv.>v.>v>..v......v>>..>>v..v",
    ">..v.v..>.v...v>.v....>..>>..>vv.v..vv>.vvvv>...>..v...>.v.>v>>..>...>v.vvv...v>v.vvv>..>vv.v>v>>v>..>...>.....v>v.>v.vv>v>..v>v>.v....v..>",
];

const EMPTY_SPACE: char = '.';
const EAST_FACING_SEA_CUCUMBER: char = '>';
const SOUTH_FACING_SEA_CUCUMBER: char = 'v';

struct Seafloor {
    /// State of the seafloor. Each cell is one of:
    /// * [EMPTY_SPACE],
    /// * [EAST_FACING_SEA_CUCUMBER],
    /// * [SOUTH_FACING_SEA_CUCUMBER].
    grid: Grid<char>,
}

impl Seafloor {
    fn from_rows(rows: &[&str]) -> Seafloor {
        let width = rows[0].len();
        let height = rows.len();
        let data = rows.join("").chars().collect();
        Seafloor {
            grid: Grid::new(width, height, data),
        }
    }

    /// Returns the index east of the given index, with wraparound.
    fn index_east_of(&self, index: GridIndex) -> GridIndex {
        GridIndex::new((index.column() + 1) % self.grid.width(), index.row())
    }

    /// Returns the index south of the given index, with wraparound.
    fn index_south_of(&self, index: GridIndex) -> GridIndex {
        GridIndex::new(index.column(), (index.row() + 1) % self.grid.height())
    }

    /// Simulates one step of sea cucumber movement, and returns the number of cucumbers that moved.
    fn tick(&mut self) -> u32 {
        let mut num_moves = 0;

        let mut grid_after_eastward_moves = self.grid.clone();
        for r in 0..self.grid.height() {
            for c in 0..self.grid.width() {
                let index = GridIndex::new(c, r);
                if self.grid[index] == EAST_FACING_SEA_CUCUMBER
                    && self.grid[self.index_east_of(index)] == EMPTY_SPACE
                {
                    grid_after_eastward_moves.swap_cells(index, self.index_east_of(index));
                    num_moves += 1;
                }
            }
        }

        let mut grid_after_southward_moves = grid_after_eastward_moves.clone();
        for r in 0..self.grid.height() {
            for c in 0..self.grid.width() {
                let index = GridIndex::new(c, r);
                if grid_after_eastward_moves[index] == SOUTH_FACING_SEA_CUCUMBER
                    && grid_after_eastward_moves[self.index_south_of(index)] == EMPTY_SPACE
                {
                    grid_after_southward_moves.swap_cells(index, self.index_south_of(index));
                    num_moves += 1;
                }
            }
        }

        self.grid = grid_after_southward_moves;
        num_moves
    }
}

pub fn solution_1() -> String {
    let mut seafloor = Seafloor::from_rows(&INPUT);

    let mut num_ticks = 0;
    loop {
        let num_moves = seafloor.tick();
        num_ticks += 1;

        if num_moves == 0 {
            break;
        }
    }
    num_ticks.to_string()
}

pub fn solution_2() -> String {
    "Go start the sleigh :)".to_string()
}
